// author:   Samuel Mueller 
// version:  0.0.8 
// license:  MIT 
// homepage: http://github.com/samu/angular-table 
(function(){var t,e,i,r,n,a,o,s,l,u,c,p,g,_,h,f,d,m,b={}.hasOwnProperty,v=function(t,e){function i(){this.constructor=t}for(var r in e)b.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};e=function(){function t(t,e){this.attribute=t.attribute,this.title=t.title,this.sortable=t.sortable,this.width=t.width,this.initialSorting=t.initialSorting,e&&(this.custom_content=e.custom_content,this.attributes=e.attributes)}return t.prototype.create_element=function(){var t;return t=angular.element(document.createElement("th")),t.attr("style","cursor: pointer;")},t.prototype.render_title=function(t){return t.html(this.custom_content||this.title)},t.prototype.render_attributes=function(t){var e,i,r,n,a;if(this.custom_content){for(n=this.attributes,a=[],i=0,r=n.length;r>i;i++)e=n[i],a.push(t.attr(e.name,e.value));return a}},t.prototype.render_sorting=function(t){var e;return this.sortable?(t.attr("ng-click","predicate = '"+this.attribute+"'; descending = !descending;"),e=angular.element("<i style='margin-left: 10px;'></i>"),e.attr("ng-class","getSortIcon('"+this.attribute+"')"),t.append(e)):void 0},t.prototype.render_width=function(t){return t.attr("width",this.width)},t.prototype.render_html=function(){var t;return t=this.create_element(),this.render_title(t),this.render_attributes(t),this.render_sorting(t),this.render_width(t),t},t}(),o=function(){function t(t,e){this.table_element=t,this.attributes=e,this.id=this.attributes.id,this.list=this.attributes[g],this.attributes[p]&&this.register_items_per_page(this.attributes[p]),this.register_sort_context(this.attributes[_]),this.register_fill_last_page(this.attributes[u]),this.paginated=void 0!==this.items_per_page,this.create_column_configurations()}return t.prototype.register_items_per_page=function(t){return isNaN(t)?this.items_per_page=t:(this.items_per_page=""+this.id+"_itemsPerPage",this.initial_items_per_page=parseInt(t))},t.prototype.register_sort_context=function(t){return void 0!==t?"global"===t?(this.sort_context=""+this.id+"_sortContext",this.initial_sort_context="global"):"page"===t?(this.sort_context=""+this.id+"_sortContext",this.initial_sort_context="page"):this.sort_context=t:(this.sort_context=""+this.id+"_sortContext",this.initial_sort_context="global")},t.prototype.register_fill_last_page=function(t){return void 0!==t?"true"===t?(this.fill_last_page=""+this.id+"_fillLastPage",this.initial_fill_last_page=!0):"false"===t?(this.fill_last_page=""+this.id+"_fillLastPage",this.initial_fill_last_page=!1):""===t?(this.fill_last_page=""+this.id+"_fillLastPage",this.initial_fill_last_page=!0):this.fill_last_page=t:void 0},t.prototype.capitaliseFirstLetter=function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""},t.prototype.extractWidth=function(t){var e;return e=/([0-9]+px)/i.exec(t),e?e[0]:""},t.prototype.isSortable=function(t){var e;return e=/(sortable)/i.exec(t),e?!0:!1},t.prototype.getInitialSorting=function(t){var e;if(e=t.attr("at-initial-sorting")){if("asc"===e||"desc"===e)return e;throw"Invalid value for initial-sorting: "+e+". Allowed values are 'asc' or 'desc'."}return void 0},t.prototype.collect_header_markup=function(t){var e,i,r,n,a,o;for(e={},r=t.find("tr"),o=r.find("th"),n=0,a=o.length;a>n;n++)i=o[n],i=angular.element(i),e[i.attr("at-attribute")]={custom_content:i.html(),attributes:i[0].attributes};return e},t.prototype.collect_body_markup=function(t){var e,i,r,n,a,o,s,l,u,c;for(i=[],c=t.find("td"),l=0,u=c.length;u>l;l++)a=c[l],a=angular.element(a),e=a.attr("at-attribute"),o=a.attr("at-title")||this.capitaliseFirstLetter(a.attr("at-attribute")),n=void 0!==a.attr("at-sortable")||this.isSortable(a.attr("class")),s=this.extractWidth(a.attr("class")),r=this.getInitialSorting(a),i.push({attribute:e,title:o,sortable:n,width:s,initialSorting:r});return i},t.prototype.create_column_configurations=function(){var t,i,r,n,a;for(i=this.collect_header_markup(this.table_element),t=this.collect_body_markup(this.table_element),this.column_configurations=[],n=0,a=t.length;a>n;n++)r=t[n],this.column_configurations.push(new e(r,i[r.attribute]));return this.column_configurations},t}(),r=function(){function t(){}return t.prototype.setupTr=function(t,e){var i,r;return i=t.find("tbody"),r=i.find("tr"),r.attr("ng-repeat",e),i},t}(),n=function(t){function e(t){this.repeatString="item in "+t.list+" | orderBy:predicate:descending"}return v(e,t),e.prototype.compile=function(t){return this.setupTr(t,this.repeatString)},e.prototype.link=function(){},e}(r),i=function(t){function e(t){this.table_configuration=t,this.repeatString="item in filtered_list()"}return v(e,t),e.prototype.compile=function(t){var e,i,r,n,a,o,s;for(i=this.setupTr(t,this.repeatString),a=t.find("td"),n="",o=0,s=a.length;s>o;o++)r=a[o],n+="<td>&nbsp;</td>";e=angular.element(document.createElement("tr")),e.attr("ng-show",this.table_configuration.fill_last_page),e.html(n),e.attr("ng-repeat","item in getFillerArray() "),i.append(e)},e.prototype.link=function(t,e,i,r){var n,a,o;return a=this.table_configuration.list,n=this.table_configuration.items_per_page,o=this.table_configuration.sort_context,t.filtered_list=function(){var e;return e=t[a],"global"===t[o]?(e=r("orderBy")(e,t.predicate,t.descending),e=r("limitTo")(e,t[d]),e=r("limitTo")(e,t[n])):(e=r("limitTo")(e,t[d]),e=r("limitTo")(e,t[n]),e=r("orderBy")(e,t.predicate,t.descending)),e},t.getFillerArray=function(){var e,i,r,o,s,l,u;if(t[f]===t[m]-1){if(i=t[a].length%t[n],0!==i||0===t[a].length){for(e=t[n]-i-1,u=[],r=o=s=t[a].length,l=t[a].length+e;l>=s?l>=o:o>=l;r=l>=s?++o:--o)u.push(r);return u}return[]}}},e}(r),a=function(){function t(t,e){this.element=t,this.table_configuration=e}return t.prototype.constructHeader=function(){var t,e,i,r,n;for(e=angular.element(document.createElement("tr")),n=this.table_configuration.column_configurations,i=0,r=n.length;r>i;i++)t=n[i],e.append(t.render_html());return e},t.prototype.setup_header=function(){var t,e,i;return e=this.element.find("thead"),e?(t=this.constructHeader(),i=angular.element(e).find("tr"),i.remove(),e.append(t)):void 0},t.prototype.get_setup=function(){return this.table_configuration.paginated?new i(this.table_configuration):new n(this.table_configuration)},t.prototype.compile=function(){return this.setup_header(),this.setup=this.get_setup(),this.setup.compile(this.element)},t.prototype.setup_initial_sorting=function(t){var e,i,r,n,a;for(n=this.table_configuration.column_configurations,a=[],i=0,r=n.length;r>i;i++){if(e=n[i],e.initialSorting&&!e.attribute)throw"initial-sorting specified without attribute.";t.predicate=e.attribute,a.push(t.descending="desc"===e.initialSorting)}return a},t.prototype.post=function(t,e,i,r){return this.setup_initial_sorting(t),t.getSortIcon=function(e){return e!==t.predicate?"icon-minus":t.descending?"icon-chevron-down":"icon-chevron-up"},this.setup.link(t,e,i,r)},t}(),angular.module("angular-table",[]),d="from_page",f="current_page",m="number_of_pages",g="atList",p="atItemsPerPage",u="atFillLastPage",_="atSortContext",l="at-attribute",h="at-sortable",c="at-initial-sorting",s=function(t,e,i){return i?t*e-i.length:void 0},t=function(){function t(){this.mappings={}}return t.prototype.get_table_configuration=function(t){return this.mappings[t].table_configuration},t.prototype.register_table=function(t){var e,i,r;if(e=(i=this.mappings)[r=t.id]||(i[r]={}),e.table_configuration=t,e.pagination_scope)throw"WHOOPS"},t.prototype.register_table_scope=function(t,e){var i;return this.mappings[t].table_scope=e,i=this.mappings[t].table_configuration,i.initial_items_per_page&&(e.$parent[i.items_per_page]=i.initial_items_per_page),i.initial_sort_context&&(e.$parent[i.sort_context]=i.initial_sort_context),i.initial_fill_last_page?e.$parent[i.fill_last_page]=i.initial_fill_last_page:void 0},t.prototype.register_pagination_scope=function(t,e){var i,r;return i=(r=this.mappings)[t]||(r[t]={}),i.pagination_scope=e,i.table_configuration?e.$watch(f,function(){var t;return t=i.table_scope,t[f]=e[f],t[m]=e[m],t[d]=s(t[i.table_configuration.items_per_page],t[f],t[i.table_configuration.list])}):void 0},t}(),angular.module("angular-table").service("angularTableManager",[function(){return new t}]),angular.module("angular-table").directive("atTable",["$filter","angularTableManager",function(t,e){return{restrict:"AC",scope:!0,controller:["$scope","$element","$attrs",function(t,i,r){var n;return n=r.id,n?e.register_table_scope(n,t):void 0}],compile:function(i,r){var n,s;return s=new o(i,r),e.register_table(s),n=new a(i,s),n.compile(),{post:function(e,i,r){return n.post(e,i,r,t)}}}}}]),angular.module("angular-table").directive("atPagination",["angularTableManager",function(t){return{replace:!0,restrict:"E",template:"      <div class='pagination' style='margin: 0px;'>        <ul>          <li ng-class='{disabled: "+f+" <= 0}'>            <a href='' ng-click='go_to_page("+f+" - 1)'>&laquo;</a>          </li>          <li ng-class='{active: "+f+" == page}' ng-repeat='page in pages'>            <a href='' ng-click='go_to_page(page)'>{{page + 1}}</a>          </li>          <li ng-class='{disabled: "+f+" >= "+m+" - 1}'>            <a href='' ng-click='go_to_page("+f+" + 1); normalize()'>&raquo;</a>          </li>        </ul>      </div>",controller:["$scope","$element","$attrs",function(e,i,r){return t.register_pagination_scope(r.atTableId,e)}],scope:!0,link:function(e,i,r){var n,a,o;return a=t.get_table_configuration(r.atTableId),e[f]=0,o=function(){var t;return e[f]=0,e[a.list]?e[a.list].length>0?(e[m]=Math.ceil(e[a.list].length/e[a.items_per_page]),e.pages=function(){var i,r,n;for(n=[],t=i=0,r=e[m]-1;r>=0?r>=i:i>=r;t=r>=0?++i:--i)n.push(t);return n}()):(e[m]=1,e.pages=[0]):void 0},n=function(t){return t=Math.max(0,t),t=Math.min(e[m]-1,t)},e.go_to_page=function(t){return e[f]=n(t)},o(),e.$watch(a.items_per_page,function(){return o()}),e.$watch(a.list,function(){return o()})}}}]),angular.module("angular-table").directive("atImplicit",[function(){return{restrict:"AC",compile:function(t){var e;if(e=t.attr("at-attribute"),!e)throw"at-implicit specified without at-attribute: "+t.html();return t.append("{{item."+e+"}}")}}}])}).call(this);